<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script type="text/javascript">
		//for zoom detection
		px_ratio = window.devicePixelRatio || window.screen.availWidth / window.innerWidth;

		$(window).resize(function(){isZooming();});

		function isZooming(){
			var newPx_ratio = window.devicePixelRatio || window.screen.availWidth / window.innerWidth;
			if(newPx_ratio != px_ratio){
				px_ratio = newPx_ratio;
				window.on_zoom()
				return true;
			}else{
				return false;
			}
		}

	</script>
	<script type="text/javascript">
		function getX(bunks, cargo_space, outfit_space) {
			return (0.5 * bunks + 0 * cargo_space + 1 * outfit_space) / 3
		}
		
		
		function getY(bunks, cargo_space, outfit_space) {
			return (0 * bunks + 1 * cargo_space + 1 * outfit_space) / 3
		}
		$(document).ready(function () {
			window.ctrlPressed = false;
			ship_stats = {"Aerie": {"name": "Aerie", "sprite": "ship/aerie", "outfit_space": 0.8333333333333334, "cargo_space": 0.10683760683760683, "bunks": 0.05982905982905983}, "Argosy": {"name": "Argosy", "sprite": "ship/argosy", "outfit_space": 0.6683168316831684, "cargo_space": 0.297029702970297, "bunks": 0.034653465346534656}, "Arrow": {"name": "Arrow", "sprite": "ship/arrow", "outfit_space": 0.9230769230769231, "cargo_space": 0.05128205128205128, "bunks": 0.02564102564102564}, "Auxiliary": {"name": "Auxiliary", "sprite": "ship/auxiliaryh", "outfit_space": 0.5901639344262295, "cargo_space": 0.20491803278688525, "bunks": 0.20491803278688525}, "Bactrian": {"name": "Bactrian", "sprite": "ship/bactrian", "outfit_space": 0.4884488448844885, "cargo_space": 0.34983498349834985, "bunks": 0.1617161716171617}, "Barb": {"name": "Barb", "sprite": "ship/barb", "outfit_space": 0.9770114942528736, "cargo_space": 0.0, "bunks": 0.022988505747126436}, "Bastion": {"name": "Bastion", "sprite": "ship/bastion", "outfit_space": 0.7580645161290323, "cargo_space": 0.1774193548387097, "bunks": 0.06451612903225806}, "Behemoth": {"name": "Behemoth", "sprite": "ship/behemoth", "outfit_space": 0.49514563106796117, "cargo_space": 0.47572815533980584, "bunks": 0.02912621359223301}, "Berserker": {"name": "Berserker", "sprite": "ship/berserker", "outfit_space": 0.9433962264150944, "cargo_space": 0.04716981132075472, "bunks": 0.009433962264150943}, "Blackbird": {"name": "Blackbird", "sprite": "ship/blackbird", "outfit_space": 0.7990867579908676, "cargo_space": 0.136986301369863, "bunks": 0.0639269406392694}, "Bounder": {"name": "Bounder", "sprite": "ship/bounder", "outfit_space": 0.7942238267148014, "cargo_space": 0.1444043321299639, "bunks": 0.061371841155234655}, "Boxwing": {"name": "Boxwing", "sprite": "ship/boxwing", "outfit_space": 0.35714285714285715, "cargo_space": 0.6349206349206349, "bunks": 0.007936507936507936}, "Bulk Freighter": {"name": "Bulk Freighter", "sprite": "ship/bulk freighter", "outfit_space": 0.39883268482490275, "cargo_space": 0.5836575875486382, "bunks": 0.017509727626459144}, "Carrier": {"name": "Carrier", "sprite": "ship/carrier", "outfit_space": 0.7427536231884058, "cargo_space": 0.09057971014492754, "bunks": 0.16666666666666666}, "Class C Freighter": {"name": "Class C Freighter", "sprite": "ship/bulk freighter", "outfit_space": 0.8639308855291576, "cargo_space": 0.04319654427645788, "bunks": 0.09287257019438445}, "Clipper": {"name": "Clipper", "sprite": "ship/clipper", "outfit_space": 0.7669616519174042, "cargo_space": 0.20648967551622419, "bunks": 0.02654867256637168}, "Combat Drone": {"name": "Combat Drone", "sprite": "ship/combat drone", "outfit_space": 1.0, "cargo_space": 0.0, "bunks": 0.0}, "Corvette": {"name": "Corvette", "sprite": "ship/corvette", "outfit_space": 0.8536585365853658, "cargo_space": 0.08130081300813008, "bunks": 0.06504065040650407}, "Cruiser": {"name": "Cruiser", "sprite": "ship/cruiser", "outfit_space": 0.7949790794979079, "cargo_space": 0.06276150627615062, "bunks": 0.14225941422594143}, "Dagger": {"name": "Dagger", "sprite": "ship/dagger", "outfit_space": 0.989010989010989, "cargo_space": 0.0, "bunks": 0.01098901098901099}, "Dreadnought": {"name": "Dreadnought", "sprite": "ship/dreadnought", "outfit_space": 0.7618129218900676, "cargo_space": 0.09643201542912247, "bunks": 0.14175506268081003}, "Dropship": {"name": "Dropship", "sprite": "ship/dropship", "outfit_space": 0.8771929824561403, "cargo_space": 0.043859649122807015, "bunks": 0.07894736842105263}, "Falcon": {"name": "Falcon", "sprite": "ship/falcon", "outfit_space": 0.7659574468085106, "cargo_space": 0.1276595744680851, "bunks": 0.10638297872340426}, "Finch": {"name": "Finch", "sprite": "ship/finch", "outfit_space": 0.990990990990991, "cargo_space": 0.0, "bunks": 0.009009009009009009}, "Firebird": {"name": "Firebird", "sprite": "ship/firebird", "outfit_space": 0.847457627118644, "cargo_space": 0.1059322033898305, "bunks": 0.046610169491525424}, "Flivver": {"name": "Flivver", "sprite": "ship/flivver", "outfit_space": 0.9420289855072463, "cargo_space": 0.036231884057971016, "bunks": 0.021739130434782608}, "Freighter": {"name": "Freighter", "sprite": "ship/freighter", "outfit_space": 0.6142506142506142, "cargo_space": 0.36855036855036855, "bunks": 0.0171990171990172}, "Frigate": {"name": "Frigate", "sprite": "ship/frigate", "outfit_space": 0.8384458077709611, "cargo_space": 0.07157464212678936, "bunks": 0.08997955010224949}, "Fury": {"name": "Fury", "sprite": "ship/fury", "outfit_space": 0.898876404494382, "cargo_space": 0.08426966292134831, "bunks": 0.016853932584269662}, "Gunboat": {"name": "Gunboat", "sprite": "ship/gunboat", "outfit_space": 0.8132530120481928, "cargo_space": 0.15060240963855423, "bunks": 0.03614457831325301}, "Hauler": {"name": "Hauler", "sprite": "ship/hauler i", "outfit_space": 0.7113821138211383, "cargo_space": 0.26422764227642276, "bunks": 0.024390243902439025}, "Hauler II": {"name": "Hauler II", "sprite": "ship/hauler ii", "outfit_space": 0.5627009646302251, "cargo_space": 0.4180064308681672, "bunks": 0.01929260450160772}, "Hauler III": {"name": "Hauler III", "sprite": "ship/hauler iii", "outfit_space": 0.4654255319148936, "cargo_space": 0.5186170212765957, "bunks": 0.015957446808510637}, "Hawk": {"name": "Hawk", "sprite": "ship/hawk", "outfit_space": 0.8928571428571429, "cargo_space": 0.08928571428571429, "bunks": 0.017857142857142856}, "Headhunter": {"name": "Headhunter", "sprite": "ship/headhunter", "outfit_space": 0.8223684210526315, "cargo_space": 0.16447368421052633, "bunks": 0.013157894736842105}, "Heavy Shuttle": {"name": "Heavy Shuttle", "sprite": "ship/heavy shuttle", "outfit_space": 0.7361963190184049, "cargo_space": 0.2147239263803681, "bunks": 0.049079754601226995}, "Lance": {"name": "Lance", "sprite": "ship/lance", "outfit_space": 0.9900990099009901, "cargo_space": 0.0, "bunks": 0.009900990099009901}, "Leviathan": {"name": "Leviathan", "sprite": "ship/leviathan", "outfit_space": 0.8115183246073299, "cargo_space": 0.10471204188481675, "bunks": 0.08376963350785341}, "Manta": {"name": "Manta", "sprite": "ship/manta", "outfit_space": 0.9210526315789473, "cargo_space": 0.05263157894736842, "bunks": 0.02631578947368421}, "Modified Argosy": {"name": "Modified Argosy", "sprite": "ship/modified argosy", "outfit_space": 0.8252427184466019, "cargo_space": 0.14563106796116504, "bunks": 0.02912621359223301}, "Mule": {"name": "Mule", "sprite": "ship/mule", "outfit_space": 0.6738131699846861, "cargo_space": 0.26033690658499237, "bunks": 0.06584992343032159}, "Nest": {"name": "Nest", "sprite": "ship/nest", "outfit_space": 0.8810572687224669, "cargo_space": 0.0881057268722467, "bunks": 0.030837004405286344}, "Osprey": {"name": "Osprey", "sprite": "ship/osprey", "outfit_space": 0.8754863813229572, "cargo_space": 0.07782101167315175, "bunks": 0.04669260700389105}, "Protector": {"name": "Protector", "sprite": "ship/protector", "outfit_space": 0.8272859216255443, "cargo_space": 0.07256894049346879, "bunks": 0.10014513788098693}, "Quicksilver": {"name": "Quicksilver", "sprite": "ship/quicksilver", "outfit_space": 0.9375, "cargo_space": 0.0390625, "bunks": 0.0234375}, "Rainmaker": {"name": "Rainmaker", "sprite": "ship/rainmaker", "outfit_space": 0.8550185873605948, "cargo_space": 0.09293680297397769, "bunks": 0.05204460966542751}, "Raven": {"name": "Raven", "sprite": "ship/raven", "outfit_space": 0.8668730650154799, "cargo_space": 0.09287925696594428, "bunks": 0.04024767801857585}, "Roost": {"name": "Roost", "sprite": "ship/roost", "outfit_space": 0.8241758241758241, "cargo_space": 0.14652014652014653, "bunks": 0.029304029304029304}, "Scout": {"name": "Scout", "sprite": "ship/scout", "outfit_space": 0.7665505226480837, "cargo_space": 0.1916376306620209, "bunks": 0.041811846689895474}, "Shuttle": {"name": "Shuttle", "sprite": "ship/shuttle", "outfit_space": 0.821917808219178, "cargo_space": 0.136986301369863, "bunks": 0.0410958904109589}, "Skein": {"name": "Skein", "sprite": "ship/skein", "outfit_space": 0.7836990595611285, "cargo_space": 0.18808777429467086, "bunks": 0.02821316614420063}, "Sparrow": {"name": "Sparrow", "sprite": "ship/sparrow", "outfit_space": 0.8843537414965986, "cargo_space": 0.10204081632653061, "bunks": 0.013605442176870748}, "Splinter": {"name": "Splinter", "sprite": "ship/splinter", "outfit_space": 0.8064516129032258, "cargo_space": 0.15120967741935484, "bunks": 0.04233870967741935}, "Star Barge": {"name": "Star Barge", "sprite": "ship/star barge", "outfit_space": 0.7103825136612022, "cargo_space": 0.273224043715847, "bunks": 0.01639344262295082}, "Star Queen": {"name": "Star Queen", "sprite": "ship/star queen", "outfit_space": 0.6766917293233082, "cargo_space": 0.11278195488721804, "bunks": 0.21052631578947367}, "Surveillance Drone": {"name": "Surveillance Drone", "sprite": "ship/surveillance drone", "outfit_space": 1.0, "cargo_space": 0.0, "bunks": 0.0}, "Vanguard": {"name": "Vanguard", "sprite": "ship/vanguard", "outfit_space": 0.8549618320610687, "cargo_space": 0.07633587786259542, "bunks": 0.06870229007633588}, "Wasp": {"name": "Wasp", "sprite": "ship/wasp", "outfit_space": 0.9259259259259259, "cargo_space": 0.06172839506172839, "bunks": 0.012345679012345678}}
			let minx = 1
			let miny = 1
			let maxx = 0
			let maxy = 0
			let maxv = {}
			let minv = {}
			for (var i = 0; i < Object.keys(ship_stats).length; i++) {
				let k = Object.keys(ship_stats)[i]
				let v = ship_stats[k]
				let x = getX(v.bunks, v.cargo_space, v.outfit_space)
				let y = getY(v.bunks, v.cargo_space, v.outfit_space)
				for (var j = 0; j < Object.keys(v).length; j++) {
					let k2 = Object.keys(v)[j]
					if (maxv[k2] === undefined || maxv[k2] < v[k2]) {
						maxv[k2] = v[k2]
					}
					if (minv[k2] === undefined || minv[k2] > v[k2]) {
						minv[k2] = v[k2]
					}
				}
				minx = Math.min(minx, x)
				miny = Math.min(miny, y)
				maxx = Math.max(maxx, x)
				maxy = Math.max(maxy, y)
			}
			
			for (var i = 0; i < Object.keys(ship_stats).length; i++) {
				let k = Object.keys(ship_stats)[i]
				let v = ship_stats[k]
				let x = (0.5 * v.bunks + 0 * v.cargo_space + 1 * v.outfit_space) / 3
				let y = (0 * v.bunks + 1 * v.cargo_space + 1 * v.outfit_space) / 3
				x = (x - minx) / (maxx - minx)
				y = (y - miny) / (maxy - miny)
				console.log(x, y)
				$("main").append($("<div/>")
					.attr("width", 50)
					.addClass("ship-item")
					.append($("<img/>")
						.attr("width", 50)
						.attr("src", "https://github.com/endless-sky/endless-sky/raw/master/images/" + v.sprite + ".png")
						.on("error", (ev) => {if(ev.target.src != "https://github.com/endless-sky/endless-sky/raw/master/images/" + v.src + "=0.png") ev.target.src = "https://github.com/endless-sky/endless-sky/raw/master/images/" + v.sprite + "=0.png"}))
					//.append($("<span/>").text(v["name"]))
					.attr("data-y", y)
					.attr("data-x", x)
					.attr("data-name", v.name)
				)
			}
			function transformX(x)
			{
				return 0.7 * (x * document.documentElement.clientWidth) / window.bodyScale
				
			}
			function transformY(y)
			{
				return 0.7 * (y * document.documentElement.clientHeight) / window.bodyScale
			}
			window.on_zoom = function() {
				pxRatio = window.devicePixelRatio || window.screen.availWidth / document.documentElement.clientWidth
				pxRatio *= window.bodyScale
				$(".resized")
					.attr("width", transformX(maxx) * 4)
					.attr("height", transformY(maxy) * 4)
					.width(transformX(maxx) * 4)
					.height(transformY(maxy) * 4)
				$("div.ship-item").each((idx, i) => {	
					$(i)
						.css("transform", "scale(" + pxRatio ** 0.5 * 0.9 + ")" + " translate(-50%, -50%)")
						.css("left", transformX(parseFloat($(i).attr("data-x"))))
						.css("top", transformY(parseFloat($(i).attr("data-y"))))
				})
				
				// Draw the background canvas
				ctx = $("canvas")[0].getContext('2d')
				ctx.clearRect(0, 0, $("canvas")[0].width, $("canvas")[0].height);
				console.log(ctx)
				
				ctx.beginPath()
				ctx.moveTo(transformX(0.5), transformY(0))
				ctx.lineTo(transformX(1), transformY(1))
				ctx.lineTo(transformX(0), transformY(1))
				ctx.lineTo(transformX(0.5), transformY(0))
				ctx.stroke()
				ctx.closePath()
			
				window.scroll(document.documentElement.scrollLeft / window.bodyScale, document.documentElement.scrollTop / window.bodyScale)
			}	
			window.bodyScale = 0.5
			window.on_zoom()
			$("html").on("keyup", (ev) => {
				if (ev.originalEvent.key == "Control")
				{
					window.ctrlPressed = true
				}
			})
			$("html").on("keydown", (ev) => {
				if (ev.key == "Control")
				{
					window.ctrlPressed = false
				}
			})
			$("body").on("keyup", (ev) => {
				if (ev.originalEvent.key == '+') {
					window.bodyScale *= 1.1
					on_zoom()
				}
				else if (ev.originalEvent.key == '-') {
					window.bodyScale *= 0.9
					on_zoom()
				}
			})
			function scroll(delta)
			{
				if (delta < 0) {
					bodyScale *= 0.9
				}
				else if (delta > 0) {
					bodyScale *= 1.1
				}
				on_zoom()
			}
			$('body').bind('wheel', function (e) {
				scroll(e.originalEvent.deltaY)
				// prevent page from scrolling
				return false;
			});
			//IE, Opera, Safari
			$('body').bind('mousewheel', function (e) {
				scroll(e.originalEvent.wheelDelta)
				// prevent page from scrolling
				return false;
			});
			let lastMouseX, lastMouseY
			$(".ship-item").on("click", function(ev) {
				tgt = $(ev.target).parents(".ship-item")
				$(".ship-item").each((idx, e) => {
					console.log(ev.target)
					if (e == ev.target) {
						return
					}
					tgt.css("z-index", Math.max(
						parseInt($(e).css("z-index"))+1, 
						parseInt(tgt.css("z-index")))
					)
					console.log(tgt.css("z-index"))
				})
			})
			$("html").bind("mousemove", function (ev) {
				if(ev.originalEvent.buttons & 1) {
					if (lastMouseX !== undefined)
					{
						let dX = ev.originalEvent.clientX - lastMouseX
						let dY = ev.originalEvent.clientY - lastMouseY
						console.log(dX, dY)
						window.scroll(document.documentElement.scrollLeft - dX, document.documentElement.scrollTop - dY)
					}
					lastMouseX = ev.originalEvent.clientX
					lastMouseY = ev.originalEvent.clientY
				} else {
					lastMouseX = undefined
					lastMouseY = undefined
				}
				if ($(ev.target).parents(".ship-item").length)
				{
					$("#pointer-data").css("left", ev.pageX+10)
					$("#pointer-data").css("top",  ev.pageY)
					$("#pointer-data #name").text($(ev.target).parents(".ship-item").attr("data-name"))
					$("#pointer-data").show()
					return true;	
				} else {
					$("#pointer-data").hide()
					
				}
			})
		})
	</script>
	<style type="text/css">
		div.ship-item {
			position: absolute;
			padding: 10px;
			display: grid;
			grid-template-columns: 100%;
			/*
			background-color: #FFFFFFDD;
			border: 2px solid black;
			*/
			z-index: 0;
		}
		main, canvas {
			position: absolute;
		}
		canvas.resized {
			z-index: -1;
		}
		div.ship-item span {
			text-align: center;
		}
		html, body, canvas {
			margin, padding: 0;
		}
		#pointer-data {
			position: absolute;
			border-radius: 5px;
			background-color: #111111;
			color: #CCCCCC;
			padding: 3px;
			font-size: smaller;
		}
	</style>
</head>
<body class="resized">
	<main></main>
	<canvas class="resized"></canvas>
	<div id="pointer-data">
		<span id="name"></span>
	</div>
</body>
</html>
